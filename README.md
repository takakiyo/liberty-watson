# liberty-watson

Technology Showcaseで実施するデモのサンプル・プロジェクトです。
DevOpsの考え方を取り入れ，ローカルのテスト実行からクラウド上のコンテナへのデプロイまでの標準手順をしめしています。
デモを実施するShowcaseのクラウド上に，この環境を常に置いておく必要はありません。
必要なときにデプロイ作業をおこなえば，短時間で動作確認済みの環境が使えるようになります。

いかのコマンドなどで「liberty-watson」とされている部分は，適宜，プロジェクトの名前に置き換えます。

## ローカルでの実行

このサンプルプロジェクトでは，WebSphere Liberty上で実行するWebアプリケーションを提供します。
クラウド上のWatsonサービスに接続し，ピザの注文を行うサイトのデモをおこなうことができます。

アプリケーションならびにWebSphere Libertyの実行環境は，Mavenのプロジェクトとして定義されています。
pom.xmlならびにsrcディレクトリ以下がその実態です。

JDKならびにMavenが導入されている環境にcheckoutし，コマンドラインから以下のように実行すると，ローカルのPC上でアプリケーションをテスト実行することができます。

```
% mvn liberty:run
```

必要なLibertyの導入イメージなども，全てMavenのセントラルレポジトリから自動的にダウンロードされます。

`http://localhost:9080/`にアクセスすることで，アプリケーションが正常に実行されているかを確認できます。
サーバーを停止するにはCtrl＋Cをキーボードから入力します。

## コンテナイメージの作成とテスト

コンテナイメージを作成し，手元のコンテナ環境で実行をテストします。
podmanコマンドが使用できるようにセットアップされていることが前提です。

Dockerfileがコンテナイメージを作成するためのソースファイルです。
Mavenによるアプリケーションの作成もコンテナ上で実施するため，この手順は前章の「ローカルでの実行」をしていない状態でも実行可能です。
このステップだけであれば，ローカルの環境にJDKやMavenが導入されていなくても実行できます。

コマンドラインから以下のように実行すると，コンテナのイメージが作成されます。
ここで指定している「1.0-SNAPSHOT」というタグのバージョンは，pom.xmlに定義されたバージョンをそのまま使用しています。
pom.xmlを更新した場合などは，適宜バージョンを変更します。

```
% podman build -t liberty-watson:1.0-SNAPSHOT .
```

LibertyのコンテナイメージはDocker HubからPullされ，その上にアプリケーションを導入するようになっています。
また，このイメージは起動するとコンテナ内で9080番ポートをLISTENします。

作成したイメージを，ローカルのpodman上で起動します。コマンドラインから以下のように実行します。
コンテナの9080番ポートをローカル環境の9080番ポートに接続しています。

```
% podman run -d -p 9080:9080 liberty-watson:1.0-SNAPSHOT
```

`http://localhost:9080/`にアクセスすることで，アプリケーションが正常に実行されているかを確認できます。
サーバーを停止するには`podman ps`を実行してCONTAINER IDを調べ，`podman stop <CONTAINER ID>`，`podman rm <CONTAINER ID>`を実行します。

## デモ環境のレポジトリにイメージをPullする



## デモ環境にデプロイする
